.\\" auto-generated by docbook2man-spec $Revision: 1.25 $
.TH "PG_DUMP" "1" "2002-11-22" "Application" "PostgreSQL Client Applications"
.SH NAME
pg_dump \- extract a PostgreSQL database into a script file or other archive file
.SH SYNOPSIS
.sp
\fBpg_dump\fR\fR [ \fR\fB\fIoptions\fB\fR...\fB \fR\fR]\fR\fR [ \fR\fB\fIdbname\fB \fR\fR]\fR
.SH "DESCRIPTION"
.PP
\fBpg_dump\fR is a utility for saving a
PostgreSQL database into a script or an
archive file. The script files are in plain-text format and
contain the SQL commands required to reconstruct the database to
the state it was in at the time it was saved. To restore these
scripts, use \fBpsql\fR(1). They can be used to
reconstruct the database even on other machines and other
architectures, with some modifications even on other SQL database
products.
.PP
Furthermore, there are alternative archive file formats
that are meant to be used with \fBpg_restore\fR(1) to
rebuild the database, and they also allow
\fBpg_restore\fR to be selective about what is
restored, or even to reorder the items prior to being restored. The
archive files are also designed to be portable across
architectures.
.PP
\fBpg_dump\fR will save the information necessary to
re-generate all user-defined types, functions, tables, indexes,
aggregates, and operators. In addition, all the data is copied out
in text format so that it can be readily copied in again, as well
as imported into tools for editing.
.PP
When used with one of the archive file formats and combined with
\fBpg_restore\fR, \fBpg_dump\fR provides a
flexible archival and 
transfer mechanism. \fBpg_dump\fR can be used to
backup an entire database, then \fBpg_restore\fR can
be used to examine the archive and/or select which parts of the
database are to be restored.
The most flexible output file format is the ``custom''
format (\fB-Fc\fR). It allows for selection and
reordering of all archived items, and is compressed by default. The
\fItar\fR format (\fB-Ft\fR) is not
compressed and it is not possible to reorder data when loading, but
it is otherwise quite flexible; moreover, it can be manipulated with
other tools such as \fItar\fR.
.PP
While running \fBpg_dump\fR, one should examine the
output for any warnings (printed on standard error), especially in
light of the limitations listed below.
.PP
\fBpg_dump\fR makes consistent backups even if the
database is being used concurrently. \fBpg_dump\fR
does not block other users accessing the database (readers or
writers).
.SH "OPTIONS"
.PP
The following command-line options are used to control the output format.
.TP
\fB\fIdbname\fB\fR
Specifies the name of the database to be dumped. If this is
not specified, the environment variable
\fBPGDATABASE\fR is used. If that is not set, the
user name specified for the connection is used.
.TP
\fB-a\fR
.TP
\fB--data-only\fR
Dump only the data, not the schema (data definitions).

This option is only meaningful for the plain-text format. For
the other formats, you may specify the option when you
call \fBpg_restore\fR.
.TP
\fB-b\fR
.TP
\fB--blobs\fR
Include large objects in dump.
.TP
\fB-c\fR
.TP
\fB--clean\fR
Output commands to clean (drop)
database objects prior to (the commands for) creating them.

This option is only meaningful for the plain-text format. For
the other formats, you may specify the option when you
call \fBpg_restore\fR.
.TP
\fB-C\fR
.TP
\fB--create\fR
Begin the output with a command to create the
database itself and reconnect to the created database. (With a
script of this form, it doesn't matter which database you connect
to before running the script.)

This option is only meaningful for the plain-text format. For
the other formats, you may specify the option when you
call \fBpg_restore\fR.
.TP
\fB-d\fR
.TP
\fB--inserts\fR
Dump data as \fBINSERT\fR commands (rather
than \fBCOPY\fR). This will make restoration very
slow, but it makes the archives more portable to other SQL database
packages.
.TP
\fB-D\fR
.TP
\fB--column-inserts\fR
.TP
\fB--attribute-inserts\fR
Dump data as \fBINSERT\fR commands with explicit
column names (INSERT INTO
\fItable\fR
(\fIcolumn\fR, ...) VALUES
\&...). This will make restoration very slow,
but it is necessary if you desire to rearrange column ordering.
.TP
\fB-f \fIfile\fB\fR
.TP
\fB--file=\fIfile\fB\fR
Send output to the specified file. If this is omitted, the
standard output is used.
.TP
\fB-F \fIformat\fB\fR
.TP
\fB--format=\fIformat\fB\fR
Selects the format of the output.
\fIformat\fR can be one of the following:
.RS
.TP
\fBp\fR
Output a plain-text SQL script file (default)
.TP
\fBt\fR
Output a \fItar\fR archive suitable for input into 
\fBpg_restore\fR. Using this archive format 
allows reordering and/or exclusion of schema elements 
at the time the database is restored. It is also possible to limit 
which data is reloaded at restore time.
.TP
\fBc\fR
Output a custom archive suitable for input into 
\fBpg_restore\fR. This is the most flexible 
format in that it allows reordering of data load as well 
as schema elements. This format is also compressed by default.
.RE
.PP
.TP
\fB-i\fR
.TP
\fB--ignore-version\fR
Ignore version mismatch between
\fBpg_dump\fR and the database server.

\fBpg_dump\fR can handle databases from
previous releases of PostgreSQL, but very old versions are not
supported anymore (currently prior to 7.0). Use this option
if you need to override the version check (and if
\fBpg_dump\fR then fails, don't say you
weren't warned).
.TP
\fB-o\fR
.TP
\fB--oids\fR
Dump object identifiers (OIDs) for every
table. Use this option if your application references the OID
columns in some way (e.g., in a foreign key constraint).
Otherwise, this option should not be used.
.TP
\fB-O\fR
.TP
\fB--no-owner\fR
Do not output commands to set the
object ownership to match the original database. Typically,
\fBpg_dump\fR issues
(\fBpsql\fR-specific) \fB\\connect\fR
statements to set ownership of schema elements. See also
under \fB-R\fR and \fB-X
use-set-session-authorization\fR. Note that
\fB-O\fR does not prevent all reconnections to the
database, only the ones that are exclusively used for
ownership adjustments.

This option is only meaningful for the plain-text format. For
the other formats, you may specify the option when you
call \fBpg_restore\fR.
.TP
\fB-R\fR
.TP
\fB--no-reconnect\fR
Prohibit \fBpg_dump\fR
from outputting a script that would require reconnections to
the database while being restored. An average restoration
script usually has to reconnect several times as different
users to set the original ownerships of the objects. This
option is a rather blunt instrument because it makes
\fBpg_dump\fR lose this ownership information,
\fBunless\fR you use the \fB-X
use-set-session-authorization\fR option.

One possible reason why reconnections during restore might not
be desired is if the access to the database requires manual
interaction (e.g., passwords).

This option is only meaningful for the plain-text format. For
the other formats, you may specify the option when you
call \fBpg_restore\fR.
.TP
\fB-s\fR
.TP
\fB--schema-only\fR
Dump only the schema (data definitions), no data.
.TP
\fB-S \fIusername\fB\fR
.TP
\fB--superuser=\fIusername\fB\fR
Specify the superuser user name to use when disabling triggers.
This is only relevant if \fB--disable-triggers\fR is used.
(Usually, it's better to specify
\fB--use-set-session-authorization\fR, and then start the
resulting script as superuser.)
.TP
\fB-t \fItable\fB\fR
.TP
\fB--table=\fItable\fB\fR
Dump data for \fItable\fR only.
.TP
\fB-v\fR
.TP
\fB--verbose\fR
Specifies verbose mode. This will cause
\fBpg_dump\fR to print progress messages
to standard error.
.TP
\fB-x\fR
.TP
\fB--no-privileges\fR
.TP
\fB--no-acl\fR
Prevent dumping of access privileges (grant/revoke commands).
.TP
\fB-X use-set-session-authorization\fR
.TP
\fB--use-set-session-authorization\fR
Normally, if a (plain-text mode) script generated by
\fBpg_dump\fR must alter the current database
user (e.g., to set correct object ownerships), it uses the
\fBpsql\fR \fB\\connect\fR command.
This command actually opens a new connection, which might
require manual interaction (e.g., passwords). If you use the
\fB-X use-set-session-authorization\fR option, then
\fBpg_dump\fR will instead output SET SESSION AUTHORIZATION [\fBset_session_authorization\fR(7)] commands. This has
the same effect, but it requires that the user restoring the
database from the generated script be a database superuser.
This option effectively overrides the \fB-R\fR
option.

Since SET SESSION AUTHORIZATION [\fBset_session_authorization\fR(7)] is a
standard SQL command, whereas \fB\\connect\fR only
works in \fBpsql\fR, this option also enhances
the theoretical portability of the output script.

This option is only meaningful for the plain-text format. For
the other formats, you may specify the option when you
call \fBpg_restore\fR.
.TP
\fB-X disable-triggers\fR
.TP
\fB--disable-triggers\fR
This option is only relevant when creating a data-only dump.
It instructs \fBpg_dump\fR to include commands
to temporarily disable triggers on the target tables while
the data is reloaded. Use this if you have referential
integrity checks or other triggers on the tables that you
do not want to invoke during data reload.

Presently, the commands emitted for \fB--disable-triggers\fR
must be done as superuser. So, you should also specify
a superuser name with \fB-S\fR, or preferably specify
\fB--use-set-session-authorization\fR and then be careful to
start the resulting script as a superuser. If you give neither
option, the entire script must be run as superuser.

This option is only meaningful for the plain-text format. For
the other formats, you may specify the option when you
call \fBpg_restore\fR.
.TP
\fB-Z \fI0..9\fB\fR
.TP
\fB--compress=\fI0..9\fB\fR
Specify the compression level to use in archive formats that support 
compression (currently only the custom archive format supports compression).
.PP
.PP
The following command-line options control the database connection parameters.
.TP
\fB-h \fIhost\fB\fR
.TP
\fB--host=\fIhost\fB\fR
Specifies the host name of the machine on which the 
server
is running. If host begins with a slash, it is used 
as the directory for the Unix domain socket.
.TP
\fB-p \fIport\fB\fR
.TP
\fB--port=\fIport\fB\fR
Specifies the Internet TCP/IP port or local Unix domain socket file 
extension on which the server
is listening for connections. The port number defaults to 5432,
or the value of the \fBPGPORT\fR
environment variable (if set).
.TP
\fB-U \fIusername\fB\fR
Connect as the given user
.TP
\fB-W\fR
Force a password prompt. This should happen automatically if
the server requires password authentication.
.PP
.PP
Long option forms are only available on some platforms.
.SH "ENVIRONMENT"
.TP
\fBPGDATABASE\fR
.TP
\fBPGHOST\fR
.TP
\fBPGPORT\fR
.TP
\fBPGUSER\fR
Default connection parameters
.SH "DIAGNOSTICS"
.sp
.nf
Connection to database 'template1' failed.
connectDBStart() -- connect() failed: No such file or directory
        Is the postmaster running locally
        and accepting connections on Unix socket '/tmp/.s.PGSQL.5432'?
.sp
.fi
.PP
\fBpg_dump\fR could not attach to the 
PostgreSQL server on the specified host and port. If you see this message,
ensure that the server
is running on the proper host and that you have specified the proper
port.
.sp
.RS
.B "Note:"
\fBpg_dump\fR internally executes
\fBSELECT\fR statements. If you have problems running
\fBpg_dump\fR,
make sure you are able to select information from the database using, for
example, \fBpsql\fR(1).
.RE
.sp
.SH "NOTES"
.PP
If your installation has any local additions to the template1 database,
be careful to restore the output of \fBpg_dump\fR into a
truly empty database; otherwise you are likely to get errors due to
duplicate definitions of the added objects. To make an empty database
without any local additions, copy from template0 not template1,
for example:
.sp
.nf
CREATE DATABASE foo WITH TEMPLATE template0;
.sp
.fi
.PP
\fBpg_dump\fR has a few limitations:
.TP 0.2i
\(bu
When dumping a single table or as plain text, \fBpg_dump\fR 
does not handle large objects. Large objects must be dumped in their
entirety using one of the binary archive formats.
.TP 0.2i
\(bu
When doing a data only dump, \fBpg_dump\fR emits queries
to disable triggers on user tables before inserting the data and queries to
re-enable them after the data has been inserted. If the restore is stopped
in the middle, the system catalogs may be left in the wrong state.
.PP
.PP
Members of tar archives are limited to a size less than 8 GB.
(This is an inherent limitation of the tar file format.) Therefore
this format cannot be used if the textual representation of a table
exceeds that size. The total size of a tar archive and any of the
other output formats is not limited, except possibly by the
operating system.
.SH "EXAMPLES"
.PP
To dump a database:
.sp
.nf
$ \fBpg_dump mydb > db.out\fR
.sp
.fi
.PP
To reload this database:
.sp
.nf
$ \fBpsql -d database -f db.out\fR
.sp
.fi
.PP
To dump a database called mydb that contains
large objects to a \fItar\fR file:
.sp
.nf
$ \fBpg_dump -Ft -b mydb > db.tar\fR
.sp
.fi
.PP
To reload this database (with large objects) to an
existing database called newdb:
.sp
.nf
$ \fBpg_restore -d newdb db.tar\fR
.sp
.fi
.SH "HISTORY"
.PP
The \fBpg_dump\fR utility first appeared in
\fBPostgres95\fR release 0.02. The
non-plain-text output formats were introduced in
\fBPostgreSQL\fR release 7.1.
.SH "SEE ALSO"
\fBpg_dumpall\fR(1), \fBpg_restore\fR(1), \fBpsql\fR(1), \fIPostgreSQL Administrator's Guide\fR

